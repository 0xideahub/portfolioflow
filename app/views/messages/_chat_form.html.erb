<%# locals: (chat:) %>

<% if chat.present? %>
  <%= form_with model: Message.new, url: chat_messages_path(chat), local: true, class: "flex gap-2" do |form| %>
    <%= form.text_area :content, 
        placeholder: "Ask me anything about your finances...", 
        class: "flex-1 resize-none border border-border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",
        rows: 1,
        data: { 
          controller: "textarea-autosize",
          action: "input->textarea-autosize#resize"
        },
        maxlength: 4000 %>
    
    <%= form.hidden_field :ai_model, value: "gpt-4" %>
    
    <%= form.submit "Send", 
        class: "px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",
        data: { disable_with: "Sending..." } %>
  <% end %>
<% else %>
  <div class="flex gap-2">
    <div class="flex-1 p-3 border border-border rounded-lg bg-surface-inset">
      <p class="text-sm text-secondary">Start a new chat to begin</p>
    </div>
    <%= link_to new_chat_path, 
        class: "px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",
        data: { turbo_frame: chat_frame } do %>
      New Chat
    <% end %>
  </div>
<% end %>

<div class="rounded-lg p-4 bg-container shadow-border-xs">
  <div class="flex justify-center mb-4">
    <%= render "chats/ai_avatar" %>
  </div>

  <h3 class="text-sm font-medium text-primary mb-1 -mt-2 text-center">Enable PortfolioFlow AI</h3>

  <p class="text-sm text-secondary mb-4">PortfolioFlow AI can answer investment questions and provide portfolio insights based on your data. To use this feature you'll need to explicitly enable it.</p>

  <%# AI Status Information %>
  <div class="mb-4 p-3 rounded-lg bg-surface-inset border border-border">
    <div class="flex items-center gap-2 mb-2">
      <%= icon(ai_status_icon(Current.user), class: "w-4 h-4 #{ai_status_color(Current.user)}") %>
      <span class="text-xs font-medium text-primary">AI Status</span>
    </div>
    <p class="text-xs text-secondary"><%= ai_status_message(Current.user) %></p>
    
    <% if ai_status_for_user(Current.user) == :unavailable && Rails.application.config.app_mode.self_hosted? %>
      <div class="mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
        <p class="text-yellow-800 mb-1"><strong>Setup Required:</strong></p>
        <p class="text-yellow-700">Add your OpenAI API key to enable AI features:</p>
        <ol class="list-decimal list-inside mt-1 text-yellow-700">
          <li>Get an API key from <a href="https://platform.openai.com/api-keys" target="_blank" class="underline">OpenAI</a></li>
          <li>Add it to your environment: <code class="bg-yellow-100 px-1 rounded">OPENAI_ACCESS_TOKEN=your_key_here</code></li>
          <li>Restart the application</li>
        </ol>
      </div>
    <% end %>
  </div>

  <% if Current.user.ai_available? %>
    <%= form_with url: user_path(Current.user), method: :patch, class: "w-full", data: { turbo: false } do |form| %>
      <%= form.hidden_field "user[ai_enabled]", value: true %>
      <%= form.hidden_field "user[redirect_to]", value: "home" %>
      <%= form.submit "Enable PortfolioFlow AI", class: "cursor-pointer hover:bg-inverse-hover w-full py-2 px-4 bg-inverse fg-inverse rounded-lg text-sm font-medium" %>
    <% end %>
  <% else %>
    <div class="text-center">
      <p class="text-xs text-secondary mb-2">AI features are currently unavailable</p>
      <% if Rails.application.config.app_mode.self_hosted? %>
        <p class="text-xs text-secondary">Please configure your OpenAI API key to enable AI features</p>
      <% else %>
        <p class="text-xs text-secondary">Please try again later or contact support</p>
      <% end %>
    </div>
  <% end %>

  <div class="mt-4 text-xs text-secondary space-y-2">
    <p class="text-center">Disable anytime. All data sent to our LLM providers is anonymized.</p>
    
    <div class="bg-surface-inset p-2 rounded text-xs">
      <p class="font-medium text-primary mb-1">What AI can help with:</p>
      <ul class="list-disc list-inside space-y-1 text-secondary">
        <li>Answer questions about your portfolio</li>
        <li>Analyze spending patterns</li>
        <li>Suggest budget improvements</li>
        <li>Explain financial concepts</li>
        <li>Auto-categorize transactions</li>
      </ul>
    </div>
  </div>
</div>

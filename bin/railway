#!/usr/bin/env bash
set -e

echo "🚀 Starting Railway deployment..."

# Install dependencies
echo "📦 Installing dependencies..."
bundle install

# Precompile assets
echo "🎨 Precompiling assets..."
bundle exec rails assets:precompile

# Run database migrations
echo "🗄️ Running database migrations..."
bundle exec rails db:migrate

# Seed database if needed (only for first deployment)
if [ "$RAILWAY_ENVIRONMENT" = "production" ] && [ ! -f "/tmp/db_seeded" ]; then
  echo "🌱 Seeding database..."
  bundle exec rails db:seed
  touch /tmp/db_seeded
fi

echo "✅ Railway deployment setup complete!" 